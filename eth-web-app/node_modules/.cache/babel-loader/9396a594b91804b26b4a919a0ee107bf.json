{"ast":null,"code":"import _objectSpread from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{useState}from\"react\";import{useRecoilValue}from\"recoil\";import Container from\"../components/Container\";import Tab from\"../components/Tab\";import Card from\"../components/Card\";import Confirm from\"../components/Confirm\";import Button from\"../components/Button\";import FormFeedback from\"../components/FormFeedback\";import{providerState}from\"../database/atoms\";import Result from\"./Result\";var FormContainer=function FormContainer(_ref){var tx=_ref.tx,props=_objectWithoutProperties(_ref,[\"tx\"]);var attrs=props.attrs,tab=props.tab,contents=props.contents,messages=props.messages,label=props.label,children=props.children;/* context */var provider=useRecoilValue(providerState);/* submit */var _useState=useState(false),_useState2=_slicedToArray(_useState,2),submitted=_useState2[0],setSubmitted=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),hash=_useState4[0],setHash=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var disabled=props.disabled||submitted;var submit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var signer,_hash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setSubmitted(true);signer=provider.getSigner();_context.next=5;return tx(signer);case 5:_hash=_context.sent;setHash(_hash);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);setError(_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function submit(){return _ref2.apply(this,arguments);};}();var reset=function reset(){setSubmitted(false);setHash(undefined);setError(undefined);};/* event */var handleSubmit=function handleSubmit(e){e.preventDefault();!disabled&&submit();};/* render */var renderForm=function renderForm(){var _ref3;var button={loading:submitted,disabled:disabled};return/*#__PURE__*/_jsxs(\"form\",_objectSpread(_objectSpread({},attrs),{},{onSubmit:handleSubmit,children:[children,contents&&/*#__PURE__*/_jsx(Confirm,{list:contents}),messages===null||messages===void 0?void 0:messages.map(function(message){return/*#__PURE__*/_jsx(FormFeedback,{children:message},message);}),/*#__PURE__*/_jsx(Button,_objectSpread(_objectSpread({type:\"submit\"},button),{},{size:\"lg\",submit:true,children:(_ref3=label!==null&&label!==void 0?label:tab.current)!==null&&_ref3!==void 0?_ref3:\"Submit\"}))]}));};return/*#__PURE__*/_jsx(Container,{sm:true,children:!hash?/*#__PURE__*/_jsx(Tab,_objectSpread(_objectSpread({},tab),{},{children:renderForm()})):/*#__PURE__*/_jsx(Card,{lg:true,children:/*#__PURE__*/_jsx(Result,{hash:hash,error:error,onFail:reset})})});};export default FormContainer;","map":{"version":3,"sources":["/home/amro/MirrorProtocol/eth-web-app/src/forms/FormContainer.tsx"],"names":["useState","useRecoilValue","Container","Tab","Card","Confirm","Button","FormFeedback","providerState","Result","FormContainer","tx","props","attrs","tab","contents","messages","label","children","provider","submitted","setSubmitted","hash","setHash","error","setError","disabled","submit","signer","getSigner","reset","undefined","handleSubmit","e","preventDefault","renderForm","button","loading","map","message","current"],"mappings":"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","sourcesContent":["import { FC, FormEvent, HTMLAttributes, useState } from \"react\"\nimport { useRecoilValue } from \"recoil\"\nimport { ethers } from \"ethers\"\n\nimport Container from \"../components/Container\"\nimport Tab from \"../components/Tab\"\nimport Card from \"../components/Card\"\nimport Confirm from \"../components/Confirm\"\nimport Button from \"../components/Button\"\nimport FormFeedback from \"../components/FormFeedback\"\n\nimport { providerState } from \"../database/atoms\"\nimport Result from \"./Result\"\n\ninterface Props {\n  attrs?: HTMLAttributes<HTMLFormElement>\n  tab: Tab\n  contents?: Content[]\n  messages?: string[]\n  label?: string\n  disabled?: boolean\n  tx: (contract: ethers.providers.JsonRpcSigner) => Promise<string>\n}\n\nconst FormContainer: FC<Props> = ({ tx, ...props }) => {\n  const { attrs, tab, contents, messages, label, children } = props\n\n  /* context */\n  const provider = useRecoilValue(providerState)\n\n  /* submit */\n  const [submitted, setSubmitted] = useState(false)\n  const [hash, setHash] = useState<string>()\n  const [error, setError] = useState<Error>()\n  const disabled = props.disabled || submitted\n\n  const submit = async () => {\n    try {\n      setSubmitted(true)\n      const signer = (provider as ethers.providers.Web3Provider).getSigner()\n      const hash = await tx(signer)\n      setHash(hash)\n    } catch (error) {\n      setError(error)\n    }\n  }\n\n  const reset = () => {\n    setSubmitted(false)\n    setHash(undefined)\n    setError(undefined)\n  }\n\n  /* event */\n  const handleSubmit = (e: FormEvent) => {\n    e.preventDefault()\n    !disabled && submit()\n  }\n\n  /* render */\n  const renderForm = () => {\n    const button = { loading: submitted, disabled }\n    return (\n      <form {...attrs} onSubmit={handleSubmit}>\n        {children}\n\n        {contents && <Confirm list={contents} />}\n\n        {messages?.map((message) => (\n          <FormFeedback key={message}>{message}</FormFeedback>\n        ))}\n\n        <Button type=\"submit\" {...button} size=\"lg\" submit>\n          {label ?? tab.current ?? \"Submit\"}\n        </Button>\n      </form>\n    )\n  }\n\n  return (\n    <Container sm>\n      {!hash ? (\n        <Tab {...tab}>{renderForm()}</Tab>\n      ) : (\n        <Card lg>\n          <Result hash={hash} error={error} onFail={reset} />\n        </Card>\n      )}\n    </Container>\n  )\n}\n\nexport default FormContainer\n"]},"metadata":{},"sourceType":"module"}