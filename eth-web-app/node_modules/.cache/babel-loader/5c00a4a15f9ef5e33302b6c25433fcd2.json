{"ast":null,"code":"import _objectSpread from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/amro/MirrorProtocol/eth-web-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{useEffect,useState}from\"react\";import{useRecoilValue}from\"recoil\";import Wait,{STATUS}from\"../components/Wait\";import Icon from\"../components/Icon\";import MirrorLink from\"../containers/MirrorLink\";import{providerState}from\"../database/atoms\";import TxHash from\"./TxHash\";import styles from\"./Result.module.scss\";var Result=function Result(_ref){var _error$message;var hash=_ref.hash,error=_ref.error,onFail=_ref.onFail;/* fetch receipt */var _useState=useState(),_useState2=_slicedToArray(_useState,2),receipt=_useState2[0],setReceipt=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),receiptError=_useState4[0],setReceiptError=_useState4[1];var provider=useRecoilValue(providerState);useEffect(function(){var wait=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _receipt;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return provider.waitForTransaction(hash);case 3:_receipt=_context.sent;setReceipt(_receipt);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);setReceiptError(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function wait(){return _ref2.apply(this,arguments);};}();wait();},[hash,provider]);/* status */var status=error?STATUS.FAILURE:receipt?STATUS.SUCCESS:STATUS.LOADING;/* render */var renderHash=function renderHash(){return/*#__PURE__*/_jsxs(\"article\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Transaction Submitted\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"View on Etherscan: \",/*#__PURE__*/_jsx(TxHash,{children:hash})]})]});};var wait={status:status,hash:renderHash(),link:status===STATUS.SUCCESS?{to:\"/my\",children:\"My Page\"}:undefined,button:status===STATUS.FAILURE?{onClick:onFail,children:\"Try Again\"}:undefined};return/*#__PURE__*/_jsxs(Wait,_objectSpread(_objectSpread({},wait),{},{children:[(_error$message=error===null||error===void 0?void 0:error.message)!==null&&_error$message!==void 0?_error$message:receiptError===null||receiptError===void 0?void 0:receiptError.message,/*#__PURE__*/_jsxs(\"p\",{className:styles.banner,children:[/*#__PURE__*/_jsx(Icon,{name:\"info\",size:12}),\"Transactions are faster at \",/*#__PURE__*/_jsx(MirrorLink,{})]})]}));};export default Result;","map":{"version":3,"sources":["/home/amro/MirrorProtocol/eth-web-app/src/forms/Result.tsx"],"names":["useEffect","useState","useRecoilValue","Wait","STATUS","Icon","MirrorLink","providerState","TxHash","styles","Result","hash","error","onFail","receipt","setReceipt","receiptError","setReceiptError","provider","wait","waitForTransaction","status","FAILURE","SUCCESS","LOADING","renderHash","link","to","children","undefined","button","onClick","message","banner"],"mappings":"osBAAA,OAASA,SAAT,CAAoBC,QAApB,KAAoC,OAApC,CACA,OAASC,cAAT,KAA+B,QAA/B,CAEA,MAAOC,CAAAA,IAAP,EAAeC,MAAf,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,IAAP,KAAiB,oBAAjB,CACA,MAAOC,CAAAA,UAAP,KAAuB,0BAAvB,CACA,OAASC,aAAT,KAA8B,mBAA9B,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,sBAAnB,CAQA,GAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,MAAoC,uBAAjCC,CAAAA,IAAiC,MAAjCA,IAAiC,CAA3BC,KAA2B,MAA3BA,KAA2B,CAApBC,MAAoB,MAApBA,MAAoB,CACjD,mBADiD,cAEnBZ,QAAQ,EAFW,wCAE1Ca,OAF0C,eAEjCC,UAFiC,8BAGTd,QAAQ,EAHC,yCAG1Ce,YAH0C,eAG5BC,eAH4B,eAIjD,GAAMC,CAAAA,QAAQ,CAAGhB,cAAc,CAACK,aAAD,CAA/B,CAEAP,SAAS,CAAC,UAAM,CACd,GAAMmB,CAAAA,IAAI,2FAAG,sLAEaD,CAAAA,QAAQ,CAACE,kBAAT,CAA4BT,IAA5B,CAFb,QAEHG,QAFG,eAGTC,UAAU,CAACD,QAAD,CAAV,CAHS,+EAKTG,eAAe,aAAf,CALS,oEAAH,kBAAJE,CAAAA,IAAI,2CAAV,CASAA,IAAI,GACL,CAXQ,CAWN,CAACR,IAAD,CAAOO,QAAP,CAXM,CAAT,CAaA,YACA,GAAMG,CAAAA,MAAM,CAAGT,KAAK,CAChBR,MAAM,CAACkB,OADS,CAEhBR,OAAO,CACPV,MAAM,CAACmB,OADA,CAEPnB,MAAM,CAACoB,OAJX,CAMA,YACA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,sBACjB,wCACE,6CADF,cAEE,wDACqB,KAAC,MAAD,WAASd,IAAT,EADrB,GAFF,GADiB,EAAnB,CASA,GAAMQ,CAAAA,IAAI,CAAG,CACXE,MAAM,CAANA,MADW,CAEXV,IAAI,CAAEc,UAAU,EAFL,CAGXC,IAAI,CACFL,MAAM,GAAKjB,MAAM,CAACmB,OAAlB,CACI,CAAEI,EAAE,CAAE,KAAN,CAAaC,QAAQ,CAAE,SAAvB,CADJ,CAEIC,SANK,CAOXC,MAAM,CACJT,MAAM,GAAKjB,MAAM,CAACkB,OAAlB,CACI,CAAES,OAAO,CAAElB,MAAX,CAAmBe,QAAQ,CAAE,WAA7B,CADJ,CAEIC,SAVK,CAAb,CAaA,mBACE,MAAC,IAAD,gCAAUV,IAAV,gCACGP,KADH,SACGA,KADH,iBACGA,KAAK,CAAEoB,OADV,iDACqBhB,YADrB,SACqBA,YADrB,iBACqBA,YAAY,CAAEgB,OADnC,cAEE,WAAG,SAAS,CAAEvB,MAAM,CAACwB,MAArB,wBACE,KAAC,IAAD,EAAM,IAAI,CAAC,MAAX,CAAkB,IAAI,CAAE,EAAxB,EADF,4CAE6B,KAAC,UAAD,IAF7B,GAFF,IADF,CASD,CA1DD,CA4DA,cAAevB,CAAAA,MAAf","sourcesContent":["import { useEffect, useState } from \"react\"\nimport { useRecoilValue } from \"recoil\"\nimport { ethers } from \"ethers\"\nimport Wait, { STATUS } from \"../components/Wait\"\nimport Icon from \"../components/Icon\"\nimport MirrorLink from \"../containers/MirrorLink\"\nimport { providerState } from \"../database/atoms\"\nimport TxHash from \"./TxHash\"\nimport styles from \"./Result.module.scss\"\n\ninterface Props {\n  hash: string\n  error?: Error\n  onFail: () => void\n}\n\nconst Result = ({ hash, error, onFail }: Props) => {\n  /* fetch receipt */\n  const [receipt, setReceipt] = useState<ethers.providers.TransactionReceipt>()\n  const [receiptError, setReceiptError] = useState<Error>()\n  const provider = useRecoilValue(providerState)\n\n  useEffect(() => {\n    const wait = async () => {\n      try {\n        const receipt = await provider.waitForTransaction(hash)\n        setReceipt(receipt)\n      } catch (error) {\n        setReceiptError(error)\n      }\n    }\n\n    wait()\n  }, [hash, provider])\n\n  /* status */\n  const status = error\n    ? STATUS.FAILURE\n    : receipt\n    ? STATUS.SUCCESS\n    : STATUS.LOADING\n\n  /* render */\n  const renderHash = () => (\n    <article>\n      <h1>Transaction Submitted</h1>\n      <p>\n        View on Etherscan: <TxHash>{hash}</TxHash>\n      </p>\n    </article>\n  )\n\n  const wait = {\n    status,\n    hash: renderHash(),\n    link:\n      status === STATUS.SUCCESS\n        ? { to: \"/my\", children: \"My Page\" }\n        : undefined,\n    button:\n      status === STATUS.FAILURE\n        ? { onClick: onFail, children: \"Try Again\" }\n        : undefined,\n  }\n\n  return (\n    <Wait {...wait}>\n      {error?.message ?? receiptError?.message}\n      <p className={styles.banner}>\n        <Icon name=\"info\" size={12} />\n        Transactions are faster at <MirrorLink />\n      </p>\n    </Wait>\n  )\n}\n\nexport default Result\n"]},"metadata":{},"sourceType":"module"}